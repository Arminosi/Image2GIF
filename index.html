<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ Image2GIF v3.3</title>
    
    <!-- CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/file-list.css">
    <link rel="stylesheet" href="css/form-controls.css">
    <link rel="stylesheet" href="css/history-window-v3.css">
    <link rel="stylesheet" href="css/history-cards.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span class="title-icon">ğŸ¨</span>
                <span class="title-text" data-i18n="title">Image2GIF</span>
                <span class="title-version" data-i18n="app.version">v3.3</span>
            </h1>
            <div class="language-switch">
                <button class="lang-btn active" data-lang="zh" title="ä¸­æ–‡">ä¸­æ–‡</button>
                <span class="lang-separator">|</span>
                <button class="lang-btn" data-lang="en" title="English">ENG</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="layout-container">
                <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
                <div class="left-panel">
                    <!-- æ­¥éª¤1ï¼šé€‰æ‹©æ–‡ä»¶ -->
                    <div class="section upload-area">
                        <h3 data-i18n="step1_title">ğŸ“ æ­¥éª¤ 1: é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</h3>
                        <p data-i18n="step1_desc">é€‰æ‹©å¤šä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œæ”¯æŒPNGã€JPGã€WebPæ ¼å¼ï¼Œå°†æŒ‰æ–‡ä»¶åè‡ªåŠ¨æ’åºç”ŸæˆåŠ¨ç”»å¸§</p>
                        <input type="file" id="file-input" accept=".png,.jpg,.jpeg,.webp" multiple>
                        <button class="btn btn-primary btn-large upload-btn" onclick="document.getElementById('file-input').click()">
                            <span data-i18n="select_files_btn">ğŸ“ é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</span>
                        </button>
                    </div>
                    
                    <!-- æ­¥éª¤2ï¼šåŠ¨ç”»è®¾ç½® -->
                    <div class="section">
                        <h3 data-i18n="step2_title">ğŸ¬ æ­¥éª¤ 2: åŠ¨ç”»è®¾ç½®</h3>
                        
                        <div class="form-row">
                            <label for="frame-delay" data-i18n="frame_delay_label">â±ï¸ å¸§é—´éš” (æ¯«ç§’):</label>
                            <div class="form-control-row">
                                <input type="range" id="frame-delay" min="50" max="1000" value="100" step="10" class="range-input custom-slider">
                                <span id="delay-value" class="range-value value-display">100</span>
                                <span class="unit-label">ms</span>
                            </div>
                            <div class="form-control-row button-row" style="margin-top: 10px;">
                                <button type="button" id="apply-delay-all" class="btn btn-secondary control-btn" data-i18n="apply_to_all">åº”ç”¨åˆ°æ‰€æœ‰å¸§</button>
                                <button type="button" id="reset-delays" class="btn btn-secondary control-btn" data-i18n="reset_all">é‡ç½®æ‰€æœ‰å¸§</button>
                            </div>
                            <p class="help-text form-help-text" data-i18n="frame_delay_help">è¾ƒå°çš„å€¼=æ›´å¿«çš„åŠ¨ç”»ï¼Œè¾ƒå¤§çš„å€¼=æ›´æ…¢çš„åŠ¨ç”»ã€‚æ¯å¸§å¯å•ç‹¬è®¾ç½®æ—¶é—´é—´éš”ã€‚</p>
                        </div>
                        
                        <div class="form-row">
                            <label data-i18n="bg_color_label">ğŸ¨ èƒŒæ™¯é¢œè‰²:</label>
                            <div class="form-control-group radio-group">
                                <label class="radio-item">
                                    <input type="radio" id="bg-transparent" name="background" value="transparent" checked>
                                    <span class="radio-label" data-i18n="bg_transparent">é€æ˜</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" id="bg-white" name="background" value="#FFFFFF">
                                    <span class="radio-label" data-i18n="bg_white">ç™½è‰²</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" id="bg-black" name="background" value="#000000">
                                    <span class="radio-label" data-i18n="bg_black">é»‘è‰²</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" id="bg-custom" name="background" value="custom">
                                    <span class="radio-label" data-i18n="bg_custom">è‡ªå®šä¹‰:</span>
                                    <input type="color" id="custom-color" value="#FF0000" class="color-input">
                                </label>
                            </div>
                            <p class="help-text form-help-text" data-i18n="bg_color_help">é€‰æ‹©GIFçš„èƒŒæ™¯é¢œè‰²ï¼ˆé€æ˜åŒºåŸŸå°†æ˜¾ç¤ºæ­¤é¢œè‰²ï¼‰</p>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤3ï¼šç”ŸæˆåŠ¨ç”» -->
                    <div class="section">
                        <h3 data-i18n="step3_title">ğŸš€ æ­¥éª¤ 3: ç”ŸæˆåŠ¨ç”»</h3>
                        <div class="button-group">
                            <button id="generate-btn" class="btn btn-success btn-large generate-btn" disabled>
                                <span data-i18n="generate_btn">ğŸ¬ ç”ŸæˆGIFåŠ¨ç”»</span>
                            </button>
                            <button id="open-history-btn" class="btn btn-secondary history-btn" data-i18n-title="history_btn_title">
                                <span data-i18n="history_btn">ğŸ“± å†å²è®°å½•</span>
                            </button>
                        </div>
                        
                        <div id="progress-container" class="progress-container" style="display: none;">
                            <div id="progress-bar" class="progress-fill">0%</div>
                        </div>
                    </div>
                    
                    <!-- ç”Ÿæˆç»“æœåŒºåŸŸ -->
                    <div class="section result-section">
                        <h3 data-i18n="result_title">ğŸ¯ ç”Ÿæˆç»“æœ</h3>
                        <div class="result-content">
                            <div id="gif-preview-container" style="display:none;">
                                <div class="preview-wrapper">
                                    <img id="preview-gif" class="preview-gif">
                                    <button id="close-preview-btn" class="close-preview-btn" data-i18n-title="close_preview">âœ–</button>
                                </div>
                                <div class="preview-actions">
                                    <a id="download-link" href="#" download="output.gif">
                                        <button class="btn btn-success btn-large generate-btn">
                                            <span data-i18n="download_btn">ğŸ“¥ ä¸‹è½½GIF</span>
                                        </button>
                                    </a>
                                    <button id="copy-gif-btn" class="btn btn-primary btn-large">
                                        <span data-i18n="copy_btn">ğŸ“‹ å¤åˆ¶GIF</span>
                                    </button>
                                </div>
                                <div id="gif-size-info" class="size-info"></div>
                            </div>
                            <div class="no-result-message" id="no-result-message">
                                <div class="no-result-icon">ğŸ¬</div>
                                <div class="no-result-text" data-i18n="no_result_text">è¿˜æ²¡æœ‰ç”Ÿæˆç»“æœ</div>
                                <div class="no-result-hint" data-i18n="no_result_hint">ç‚¹å‡»"ç”ŸæˆGIFåŠ¨ç”»"æŒ‰é’®å¼€å§‹åˆ¶ä½œ</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å³ä¾§æ–‡ä»¶åˆ—è¡¨é¢æ¿ -->
                <div class="right-panel">
                    <div class="files-panel">
                        <div class="files-panel-header">
                            <h3 data-i18n="frame_sequence">ğŸ¬ å¸§åºåˆ—</h3>
                            <div class="files-count" id="files-count" data-i18n="files_count">0 ä¸ªæ–‡ä»¶</div>
                        </div>
                        
                        <!-- å¡ç‰‡å¤§å°æ§åˆ¶å™¨ -->
                        <div class="card-size-control" id="card-size-control" style="display: none;">
                            <div class="form-control-row">
                                <label for="card-size-slider" data-i18n="card_size_label">å¡ç‰‡å¤§å°:</label>
                                <div class="range-input-group">
                                    <input type="range" id="card-size-slider" min="100" max="250" value="150" step="10" class="range-input custom-slider">
                                    <span id="card-size-value" class="range-value value-display">150</span>
                                    <span class="unit-label">px</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="file-list" class="file-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å³é”®èœå• -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item" id="context-copy">
            <span>ğŸ“‹</span>
            <span data-i18n="context_copy">å¤åˆ¶é€‰ä¸­çš„å¸§</span>
        </div>
        <div class="context-menu-item" id="context-paste">
            <span>ğŸ“Œ</span>
            <span data-i18n="context_paste">ç²˜è´´å¸§åˆ°æ­¤ä½ç½®</span>
        </div>
        <div class="context-menu-item" id="context-delete">
            <span>ğŸ—‘ï¸</span>
            <span data-i18n="context_delete">åˆ é™¤é€‰ä¸­çš„å¸§</span>
        </div>
        <div class="context-menu-item" id="context-set-delay">
            <span>â±ï¸</span>
            <span data-i18n="context_set_delay">è®¾ç½®é€‰ä¸­å¸§æ—¶é•¿</span>
        </div>
    </div>

    <!-- å¯¹è¯æ¡†èƒŒæ™¯é®ç½©å’Œå¼¹çª— -->
    <div id="delay-dialog-overlay" class="delay-dialog-overlay">
        <div id="delay-dialog" class="delay-dialog">
            <div class="delay-dialog-header">
                <div class="delay-dialog-close" id="delay-dialog-close">âœ–</div>
                <h3 data-i18n="dialog.batch-delay.title">â±ï¸ æ‰¹é‡è®¾ç½®å¸§æ—¶é•¿</h3>
            </div>
            <div class="delay-dialog-content">
                <div class="delay-input-group">
                    <label for="batch-delay-input" data-i18n="dialog.batch-delay.duration">æŒç»­æ—¶é•¿</label>
                    <div class="delay-input-wrapper">
                        <input type="number" id="batch-delay-input" min="50" max="2000" step="10" value="100" 
                               data-i18n="dialog.batch-delay.placeholder" data-i18n-placeholder="è¾“å…¥æ¯«ç§’æ•°">
                        <span class="delay-input-suffix">ms</span>
                    </div>
                </div>
                <div class="delay-dialog-buttons">
                    <button id="delay-cancel-btn" class="control-btn" data-i18n="dialog.cancel">å–æ¶ˆ</button>
                    <button id="delay-confirm-btn" class="control-btn" data-i18n="dialog.confirm">ç¡®å®š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‚¬æµ®åˆ é™¤ç¡®è®¤å¯¹è¯æ¡† -->
    <div id="delete-dialog-overlay" class="delay-dialog-overlay">
        <div id="delete-dialog" class="delay-dialog">
            <div class="delay-dialog-header">
                <div class="delay-dialog-close" id="delete-dialog-close">âœ–</div>
                <h3 data-i18n="dialog.delete.title">ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­å¸§</h3>
            </div>
            <div class="delay-dialog-content">
                <div class="delete-confirmation-message">
                    <div class="delete-icon">âš ï¸</div>
                    <p id="delete-message">ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ <span id="delete-count">0</span> ä¸ªå¸§å—ï¼Ÿ</p>
                    <p class="delete-warning" data-i18n="dialog.delete.warning">æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼</p>
                </div>
                <div class="delay-dialog-buttons">
                    <button id="delete-cancel-btn" class="control-btn" data-i18n="dialog.cancel">å–æ¶ˆ</button>
                    <button id="delete-confirm-btn" class="control-btn delete-btn" data-i18n="dialog.delete.button">åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å³ä¸Šè§’æ‚¬æµ®çŠ¶æ€æç¤ºç³»ç»Ÿ -->
    <div id="floating-status-container" class="floating-status-container"></div>

    <!-- ä½œè€…ä¿¡æ¯ -->
    <footer class="author-info">
        <div class="author-content">
            <span class="author-text">
                <span class="author-label" data-i18n="author_label">ä½œè€…ï¼š</span>
                <span class="author-name">Arminosi</span>
            </span>
            <span class="separator">|</span>
            <span class="github-link">
                <span class="github-label">Githubï¼š</span>
                <a href="https://github.com/Arminosi/Image2GIF" target="_blank" rel="noopener noreferrer">
                    <span class="github-icon">ğŸ”—</span>
                    <span class="github-url">Image2GIF</span>
                </a>
            </span>
        </div>
    </footer>

    <!-- JavaScriptåº“å’Œæ¨¡å— -->
    <script src="https://unpkg.com/gif.js@0.2.0/dist/gif.js"></script>
    
    <!-- å›½é™…åŒ–ç³»ç»Ÿ -->
    <script src="js/i18n.js"></script>
    
    <!-- åº”ç”¨ç¨‹åºæ¨¡å— -->
    <script src="js/core.js"></script>
    <script src="js/floating-status.js"></script>
    <script src="js/history-manager-v3.js"></script>
    <script src="js/file-manager.js"></script>
    <script src="js/context-menu.js"></script>
    <script src="js/card-size-controller.js"></script>
    <script src="js/drag-sort-controller.js"></script>
    <script src="js/keyboard-shortcuts.js"></script>
    <script src="js/gif-generator.js"></script>
    <script src="js/app.js"></script>
    
    <!-- æ–‡ä»¶è®¡æ•°æ›´æ–°è„šæœ¬ -->
    <script>
        // æ›´æ–°æ–‡ä»¶è®¡æ•°çš„å‡½æ•°
        function updateFilesCount() {
            const fileItems = document.querySelectorAll('#file-list .file-item');
            const count = fileItems.length;
            const countElement = document.getElementById('files-count');
            if (countElement && window.i18n) {
                if (window.i18n.getCurrentLanguage() === 'zh') {
                    countElement.textContent = `${count} ä¸ªæ–‡ä»¶`;
                } else {
                    countElement.textContent = count === 1 ? `${count} file` : `${count} files`;
                }
            }
        }
        
        // ç›‘å¬æ–‡ä»¶åˆ—è¡¨å˜åŒ–
        const fileList = document.getElementById('file-list');
        if (fileList) {
            const observer = new MutationObserver(updateFilesCount);
            observer.observe(fileList, { childList: true, subtree: true });
        }
        
        // ç›‘å¬è¯­è¨€åˆ‡æ¢ï¼Œæ›´æ–°æ–‡ä»¶è®¡æ•°
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('lang-btn')) {
                setTimeout(updateFilesCount, 100); // å»¶è¿Ÿæ›´æ–°ï¼Œç¡®ä¿è¯­è¨€å·²åˆ‡æ¢
            }
        });
        
        // åˆå§‹æ›´æ–°
        document.addEventListener('DOMContentLoaded', updateFilesCount);
        
        // ç®¡ç†ç”Ÿæˆç»“æœæ˜¾ç¤ºçŠ¶æ€
        function updateResultDisplay() {
            const gifPreviewContainer = document.getElementById('gif-preview-container');
            const noResultMessage = document.getElementById('no-result-message');
            
            if (gifPreviewContainer && noResultMessage) {
                if (gifPreviewContainer.style.display === 'none' || !gifPreviewContainer.style.display) {
                    // æ˜¾ç¤ºæ— ç»“æœçŠ¶æ€
                    noResultMessage.style.display = 'block';
                } else {
                    // éšè—æ— ç»“æœçŠ¶æ€
                    noResultMessage.style.display = 'none';
                }
            }
        }
        
        // ç›‘å¬é¢„è§ˆå®¹å™¨æ˜¾ç¤ºçŠ¶æ€å˜åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const gifPreviewContainer = document.getElementById('gif-preview-container');
            if (gifPreviewContainer) {
                // åˆå§‹æ£€æŸ¥
                updateResultDisplay();
                
                // ä½¿ç”¨MutationObserverç›‘å¬styleå˜åŒ–
                const styleObserver = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            updateResultDisplay();
                        }
                    });
                });
                
                styleObserver.observe(gifPreviewContainer, {
                    attributes: true,
                    attributeFilter: ['style']
                });
            }
        });
    </script>
</body>
</html>
